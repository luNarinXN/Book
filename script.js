// Код для современного минималистичного сайта с книгой
// Основной модуль приложения
const App = (() => {
    // Состояние приложения
    const state = {
        currentPage: 'main',
        theme: 'dark',
        bookOpened: false,
        descriptionOpened: false,
        prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches,
        currentChapter: 1,
        totalChapters: 10,
        chapters: [
            { 
                id: 1, 
                title: 'Пепел и обещания',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 1. Пепел и обещания</h2>
                        <p>Пепел ложился на улицы города, как покрывало забвения. Он был везде — в трещинах мостовой, на крышах, в глазах тех, кто ещё не забыл, как выглядело солнце. Мир Пепла не был мёртв, но умирал медленно, с достоинством, как старый король, отрёкшийся от трона.</p>
                        
                        <p>Каэль Вирен стоял над телом. Оно было чужим — не только для этого мира, но и для всей реальности. Мужчина лет тридцати, с кожей цвета меди и глазами, которые всё ещё не потускнели. Он умер недавно. И не здесь.</p>
                        
                        <p>— Третий случай за неделю, — пробормотал Каэль, проводя пальцами по воздуху. Серебристая пыль вспыхнула — магический след. Эмоция: страх. Сильный. Почти животный.</p>
                        
                        <p>Из тени вышла Лира Сайо. Её движения были лёгкими, как ветер, но в глазах — буря.</p>
                        
                        <p>— Ты опять разговариваешь с мёртвыми? — спросила она, прислонившись к стене.</p>
                        
                        <p>— Они — единственные, кто не лжёт, — ответил Каэль, не отрывая взгляда от тела.</p>
                        
                        <p>Лира подошла ближе. Их дыхание смешалось. Напряжение между ними было почти осязаемым. Каэль почувствовал, как её пальцы коснулись его запястья — не для утешения, а для проверки. Он был жив. Пока что.</p>
                        
                        <p>— Этот мир умирает, — сказала она. — Но кто-то хочет, чтобы он умер быстрее.</p>
                        
                        <p>— И мы должны узнать — кто.</p>
                        
                        <p>Они молчали. Вдалеке раздался гул — портал открывался. Кто-то прибыл. Или уходил.</p>
                        
                        <p>Каэль поднял голову. Его глаза вспыхнули синим — активация способности. Он видел следы. Эмоции, магию, боль. Всё, что оставалось после.</p>
                        
                        <p>— Он пришёл из Мира Ветра, — сказал он. — Но умер здесь. Кто-то хотел, чтобы мы нашли его.</p>
                        
                        <p>— Или чтобы мы не нашли того, кто его убил.</p>
                        
                        <p>Лира усмехнулась. Её губы были близко. Слишком близко.</p>
                        
                        <p>— Ты всегда такой мрачный?</p>
                        
                        <p>— Только когда рядом ты.</p>
                        
                        <p>Она наклонилась, её волосы коснулись его щеки. Он почувствовал запах — смесь лаванды и пороха.</p>
                        
                        <p>— Осторожно, Каэль. Я могу стать твоей последней ошибкой.</p>
                        
                        <p>— Или первой правильной.</p>
                        
                        <p>Их губы почти соприкоснулись, но в этот момент раздался взрыв. Пыль взметнулась, и из неё вышел Саймон Дрейл — алхимик, одетый в мантии Мира Разума.</p>
                        
                        <p>— Вы оба — идиоты, — сказал он, отряхивая одежду. — Тело — ловушка. Оно заражено.</p>
                        
                        <p>Каэль отступил. Лира — нет.</p>
                        
                        <p>— Заражено чем?</p>
                        
                        <p>— Эмоцией. Искусственной. Кто-то внедрил страх в его сознание. Это не просто убийство. Это — послание.</p>
                        
                        <p>Каэль сжал кулаки. Его способность дрожала — следы становились неясными.</p>
                        
                        <p>— Кто-то играет с нами.</p>
                        
                        <p>— Кто-то знает, что мы ищем.</p>
                        
                        <p>— И знает, что мы найдём.</p>
                        
                        <p>Саймон подошёл к телу, провёл рукой над грудью. Вспышка — и на коже проступил символ. Круг, пересечённый линиями. Знак Межмировой Печати.</p>
                        
                        <p>— Это артефакт. Он был носителем.</p>
                        
                        <p>— Чего?</p>
                        
                        <p>— Песни.</p>
                        
                        <p>Каэль замер.</p>
                        
                        <p>— Ты уверен?</p>
                        
                        <p>— На девяносто процентов.</p>
                        
                        <p>— А на десять?</p>
                        
                        <p>— Мы все умрём.</p>
                        
                        <p>Лира рассмеялась. Её смех был как ветер — лёгкий, но режущий.</p>
                        
                        <p>— Тогда давайте умрём красиво.</p>
                    </div>
                `
            },
            { 
                id: 2, 
                title: 'Песнь пробуждается',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 2. Песнь пробуждается</h2>
                        <p>Саймон вытер лоб, оставив на пальцах следы пепла и магии. Он выглядел усталым, но глаза его горели — как всегда, когда он чувствовал загадку.</p>
                        
                        <p>— Песнь, — повторил Лира, — ты уверен, что это она?</p>
                        
                        <p>— Символ — один из семи. Печать Песни. Кто-то активировал её. Или пытался.</p>
                        
                        <p>Каэль нахмурился. Песнь была легендой. Историей, которую рассказывали детям, чтобы они не лезли в порталы. Говорили, что она — живое заклинание, способное разрушить миры или соединить их. Никто не знал, правда ли это.</p>
                        
                        <p>— Если это Песнь, — сказал он, — то кто-то хочет, чтобы мы её нашли.</p>
                        
                        <p>— Или чтобы мы её не нашли, — добавила Лира. — И использует тела как маяки.</p>
                        
                        <p>Саймон кивнул.</p>
                        
                        <p>— Я могу извлечь остатки памяти. Но это будет больно. Для всех.</p>
                        
                        <p>Каэль взглянул на Лиру. Она уже стояла рядом с телом, её пальцы скользили по коже, не касаясь, но чувствуя.</p>
                        
                        <p>— Я готова, — сказала она.</p>
                        
                        <p>— Ты всегда готова к боли?</p>
                        
                        <p>— Только если она ведёт к истине.</p>
                        
                        <p>Саймон активировал узел. Вспышка — и их сознания связались. Каэль почувствовал, как чужие эмоции проникают в него — страх, отчаяние, желание. Он увидел фрагменты: мужчина бежит по мосту, за ним — тени. Он держит артефакт. Он шепчет: «Песнь пробуждается».</p>
                        
                        <p>И затем — вспышка. Смерть.</p>
                        
                        <p>Связь оборвалась. Каэль упал на колени, его дыхание сбилось. Лира стояла, но её глаза были пустыми.</p>
                        
                        <p>— Он знал нас, — прошептала она. — Он искал нас.</p>
                        
                        <p>— Или кого-то, кто похож на нас, — сказал Саймон. — Мы — не единственные, кто охотится за Песней.</p>
                        
                        <p>Каэль поднялся. Его взгляд был твёрдым.</p>
                        
                        <p>— Мы должны найти источник. Кто активировал Песнь. Кто убивает носителей.</p>
                        
                        <p>— И кто следующий, — добавила Лира.</p>
                        
                        <p>Они вышли из переулка. Город был тих. Слишком тих. Пепел кружился в воздухе, как напоминание о том, что всё здесь — временно.</p>
                        
                        <p>Каэль почувствовал, как Лира коснулась его плеча. Он обернулся. Её глаза были близко. Слишком близко.</p>
                        
                        <p>— Ты боишься? — спросила она.</p>
                        
                        <p>— Только потерять тебя.</p>
                        
                        <p>Она улыбнулась. Её губы коснулись его — мягко, осторожно. Как обещание. Как предупреждение.</p>
                        
                        <p>— Тогда держи крепче.</p>
                    </div>
                `
            },
            { 
                id: 3, 
                title: 'Мир Ветра',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 3. Мир Ветра</h2>
                        <p>Портал в Мир Ветра был нестабильным. Его края дрожали, как дыхание перед поцелуем. Каэль стоял на границе, чувствуя, как воздух меняется — становится легче, но обманчиво опасным.</p>
                        
                        <p>— Ты уверен, что хочешь идти первым? — спросила Лира, поправляя ремень с кинжалами.</p>
                        
                        <p>— Я всегда иду первым, — ответил он. — Чтобы ты могла уйти, если всё пойдёт не так.</p>
                        
                        <p>Она усмехнулась.</p>
                        
                        <p>— А если я не хочу уходить?</p>
                        
                        <p>— Тогда иди рядом.</p>
                        
                        <p>Они шагнули в портал. Мир Ветра встретил их шумом — город в облаках, подвешенный на гигантских арках, где здания парили, а улицы были мостами из света. Здесь всё двигалось — даже тени.</p>
                        
                        <p>Саймон остался в Пепельном мире, чтобы анализировать артефакт. Каэль и Лира должны были найти следующего носителя — женщину по имени Эйра, которая, по слухам, пела Песнь во сне.</p>
                        
                        <p>Они нашли её в доме, построенном из стекла и ветра. Эйра была юной, с глазами цвета грозы. Она не говорила — только пела. И её песня была… странной.</p>
                        
                        <p>Каэль почувствовал, как его способность реагирует. Песня была магией. Но не обычной. Она была… живой.</p>
                        
                        <p>— Она не знает, что делает, — прошептала Лира. — Кто-то вложил это в неё.</p>
                        
                        <p>— Или она — ключ.</p>
                        
                        <p>Эйра замолчала. Её взгляд остановился на Каэле. Он почувствовал, как волна эмоций накрывает его — страх, страсть, одиночество. Она подошла ближе, её пальцы коснулись его груди.</p>
                        
                        <p>— Ты слышишь? — прошептала она.</p>
                        
                        <p>— Да.</p>
                        
                        <p>— Тогда спаси меня.</p>
                        
                        <p>Лира напряглась. Каэль почувствовал, как между ними возникает напряжение. Он взял Эйру за руку, осторожно, как будто она была из стекла.</p>
                        
                        <p>— Мы найдём того, кто вложил Песнь в тебя.</p>
                        
                        <p>— Он уже рядом.</p>
                        
                        <p>В этот момент окно взорвалось. В комнату ворвался мужчина в чёрной мантии, его глаза горели зелёным. Он был носителем — но не Песни. Он был охотником.</p>
                        
                        <p>Каэль бросился вперёд, активируя Пепельный след. Вспышка — и он увидел путь удара. Увернулся. Лира исчезла в тени, появилась за спиной врага, ударила.</p>
                        
                        <p>Мужчина рухнул. Но не умер. Он рассмеялся.</p>
                        
                        <p>— Вы опоздали. Песнь уже пробуждена.</p>
                        
                        <p>Он исчез — растворился в воздухе.</p>
                        
                        <p>Эйра упала на колени. Её песня оборвалась.</p>
                        
                        <p>Каэль обнял её, чувствуя, как она дрожит. Лира стояла рядом, её взгляд был холодным.</p>
                        
                        <p>— Мы не можем защитить всех, — сказала она.</p>
                        
                        <p>— Но мы можем попытаться.</p>
                        
                        <p>Эйра подняла голову. Её губы были близко. Каэль почувствовал, как она тянется к нему — не как к спасителю, а как к тому, кто слышит её.</p>
                        
                        <p>Он отстранился. Лира смотрела на него. В её глазах — вопрос.</p>
                    </div>
                `
            },
            { 
                id: 4, 
                title: 'Ночь в тумане',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 4. Ночь в тумане</h2>
                        <p>Позже, в гостинице, где стены были из тумана, Каэль сидел у окна. Лира подошла, села рядом.</p>
                        
                        <p>— Ты не поцеловал её.</p>
                        
                        <p>— Я не мог.</p>
                        
                        <p>— Почему?</p>
                        
                        <p>— Потому что думаю о тебе.</p>
                        
                        <p>Она молчала. Затем наклонилась, её губы коснулись его шеи.</p>
                        
                        <p>— Тогда не думай. Просто чувствуй.</p>
                        
                        <p>И он почувствовал — её дыхание, её пальцы, её желание. Их тела слились, как магия и пепел. В этот момент не было миров, не было Песни. Только они.</p>
                    </div>
                `
            },
            { 
                id: 5, 
                title: 'Мир Огня',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 5. Мир Огня</h2>
                        <p>Мир Огня не принимал чужаков. Здесь всё горело — не только земля, но и воздух, и взгляды. Город был построен на лаве, а дома — из металла, закалённого в ненависти.</p>
                        
                        <p>Каэль, Лира и Саймон прибыли через скрытый портал, спрятанный в кратере. Их цель — найти носителя, который, по слухам, использовал Песнь как оружие.</p>
                        
                        <p>— Здесь всё другое, — прошептала Лира, поправляя капюшон. — Даже желания пахнут дымом.</p>
                        
                        <p>Каэль чувствовал это. Его способность дрожала — следы эмоций были ярче, агрессивнее. Здесь никто не скрывал страсть. Здесь её выставляли напоказ.</p>
                        
                        <p>Они нашли носителя в арене — женщину по имени Селена, гладиаторку, чья песня убивала. Она стояла в центре, окружённая огнём, её голос — как клинок.</p>
                        
                        <p>— Вы пришли за мной? — спросила она, не прекращая петь.</p>
                        
                        <p>— Мы пришли за Песней, — ответил Каэль.</p>
                        
                        <p>— Тогда вы пришли за болью.</p>
                        
                        <p>Сражение было быстрым. Селена не хотела убивать — она хотела быть услышанной. Каэль активировал Пепельный след, увидел её страх — не перед смертью, а перед забвением.</p>
                        
                        <p>Лира подошла к ней, коснулась пальцами.</p>
                        
                        <p>— Ты не одна.</p>
                        
                        <p>Селена замолчала. Её песня исчезла. Она упала на колени.</p>
                        
                        <p>— Он сказал, что Песнь — это сила. Что она даст мне свободу.</p>
                        
                        <p>— Кто?</p>
                        
                        <p>Селена подняла глаза. И сказала имя.</p>
                        
                        <p>— Саймон.</p>
                        
                        <p>Каэль замер. Лира — тоже.</p>
                        
                        <p>— Что ты сказала?</p>
                        
                        <p>— Он дал мне артефакт. Сказал, что я должна петь. Что это поможет.</p>
                        
                        <p>Саймон стоял в тени. Его лицо было спокойным.</p>
                        
                        <p>— Я хотел понять, — сказал он. — Я не знал, что она пострадает.</p>
                        
                        <p>— Ты дал ей Песнь?</p>
                        
                        <p>— Фрагмент. Чтобы изучить. Я не знал, что она — носитель.</p>
                        
                        <p>Каэль шагнул вперёд. Его кулаки дрожали.</p>
                        
                        <p>— Ты предал нас.</p>
                        
                        <p>— Я выбрал знание.</p>
                        
                        <p>Лира встала между ними.</p>
                        
                        <p>— Мы не можем сражаться друг с другом. Не сейчас.</p>
                        
                        <p>Саймон опустил голову.</p>
                        
                        <p>— Я помогу вам. Я найду источник. Но вы должны доверять мне.</p>
                        
                        <p>Каэль молчал. Его взгляд был тяжёлым.</p>
                        
                        <p>Позже, в гостинице, где стены были из пламени, Лира подошла к нему. Он сидел у окна, смотрел на вулкан.</p>
                        
                        <p>— Ты злишься?</p>
                        
                        <p>— Я разочарован.</p>
                        
                        <p>— В нём?</p>
                        
                        <p>— В себе. Я не видел этого.</p>
                        
                        <p>Она села рядом. Её рука легла на его бедро.</p>
                        
                        <p>— Ты видишь меня?</p>
                        
                        <p>Он повернулся. Их глаза встретились. Она была близко. Слишком близко.</p>
                        
                        <p>— Всегда.</p>
                        
                        <p>Их поцелуй был как огонь — жгучий, неудержимый. Они слились в страсти, как миры, которые не должны были соединяться. В этот момент не было предательства. Только желание. Только они.</p>
                    </div>
                `
            },
            { 
                id: 6, 
                title: 'Сердце Песни',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 6. Сердце Песни</h2>
                        <p>Портал в Мир Песни был скрыт в глубинах вулкана. Он не светился, не пульсировал — он пел. Тихо, почти незаметно. Но каждый, кто слышал, чувствовал, как внутри что-то меняется.</p>
                        
                        <p>Каэль, Лира и Саймон стояли перед ним. Пепел, ветер, разум и огонь — всё позади. Впереди — истина.</p>
                        
                        <p>— Готовы? — спросил Саймон.</p>
                        
                        <p>Каэль взглянул на Лиру. Она кивнула. Он сжал её руку.</p>
                        
                        <p>— Вместе.</p>
                        
                        <p>Они шагнули внутрь.</p>
                        
                        <p>Мир Песни не был миром в привычном смысле. Это была симфония. Пространство из звуков, эмоций, воспоминаний. Здесь не было земли — только ноты, плавающие в воздухе. Здесь не было времени — только ритм.</p>
                        
                        <p>Они шли по дорожке из света, каждый шаг — аккорд. Песнь звучала вокруг, внутри, между ними.</p>
                        
                        <p>— Это… красиво, — прошептала Лира. — И страшно.</p>
                        
                        <p>— Потому что это мы, — ответил Каэль. — Всё, что мы скрывали. Всё, что мы чувствовали.</p>
                        
                        <p>В центре — источник. Существо, сотканное из звука. Оно не имело формы, но имело голос.</p>
                        
                        <p>— Вы пришли, — сказало оно. — Вы — носители. Вы — выбор.</p>
                        
                        <p>— Что ты такое? — спросил Саймон.</p>
                        
                        <p>— Я — Песнь. Я — память миров. Я — боль, любовь, предательство. Я — всё, что вы забыли.</p>
                        
                        <p>— Зачем ты пробуждаешься?</p>
                        
                        <p>— Потому что вы готовы. Потому что границы — иллюзия. Потому что любовь — сильнее смерти.</p>
                        
                        <p>Каэль почувствовал, как Песнь касается его. Он увидел Лиру — в каждом мире, в каждой жизни. Она была рядом. Всегда.</p>
                        
                        <p>— Ты хочешь, чтобы мы объединили миры?</p>
                        
                        <p>— Я хочу, чтобы вы выбрали. Разделение — безопасность. Единство — риск. Но и надежда.</p>
                        
                        <p>Лира шагнула вперёд.</p>
                        
                        <p>— А если мы выберем единство?</p>
                        
                        <p>— Тогда вы станете связью. Тогда вы потеряете себя. Но обретёте всё.</p>
                        
                        <p>Каэль взглянул на неё. В её глазах — страх. И любовь.</p>
                        
                        <p>— Я готов, — сказал он.</p>
                        
                        <p>— Я тоже, — прошептала она.</p>
                        
                        <p>Саймон молчал. Затем кивнул.</p>
                        
                        <p>— Я с вами.</p>
                        
                        <p>Песнь вспыхнула. Миры дрогнули. Границы начали таять.</p>
                        
                        <p>Каэль почувствовал, как его тело растворяется — не в смерти, а в музыке. Он был нотой. Он был аккордом. Он был с Лирой.</p>
                        
                        <p>Их поцелуй был последним, что он помнил как человек. И первым, что он почувствовал как Песнь.</p>
                    </div>
                `
            },
            { 
                id: 7, 
                title: 'Сквозь музыку и пепел',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 7. Сквозь музыку и пепел</h2>
                        <p>Миры дрожали.</p>
                        
                        <p>После пробуждения Песни границы между реальностями начали стираться. Ветер из Мира Ветра проникал в Пепельные руины, огонь из Арены вспыхивал в библиотеках Мира Разума. Люди слышали музыку во сне — и просыпались с чужими воспоминаниями.</p>
                        
                        <p>Каэль стоял на вершине разрушенной башни, глядя на горизонт. Пепел больше не падал — он парил, как будто сам не знал, куда ему идти.</p>
                        
                        <p>— Мы сделали это, — сказал он. — Но что именно?</p>
                        
                        <p>Лира подошла, её шаги были лёгкими, но взгляд — тяжёлым.</p>
                        
                        <p>— Мы открыли двери. Теперь кто угодно может войти.</p>
                        
                        <p>— Или выйти.</p>
                        
                        <p>Саймон появился из портала, его лицо было бледным.</p>
                        
                        <p>— Я нашёл след. Кто-то использует Песнь, чтобы создавать новые сущности. Они не принадлежат ни одному миру.</p>
                        
                        <p>— Гибриды? — спросила Лира.</p>
                        
                        <p>— Хуже. Они — пустые. Без эмоций. Без памяти. Только цель.</p>
                        
                        <p>Каэль сжал кулаки.</p>
                        
                        <p>— Кто их создаёт?</p>
                        
                        <p>Саймон замолчал. Затем сказал:</p>
                        
                        <p>— Я.</p>
                        
                        <p>Тишина.</p>
                        
                        <p>— Что ты сказал? — прошептала Лира.</p>
                        
                        <p>— Я не знал, что это произойдёт. Я пытался стабилизировать Песнь. Но она… откликнулась. И создала их.</p>
                        
                        <p>Каэль шагнул вперёд.</p>
                        
                        <p>— Ты снова предал нас.</p>
                        
                        <p>— Я пытался защитить вас.</p>
                        
                        <p>— Ты пытался контролировать то, что нельзя контролировать.</p>
                        
                        <p>Лира встала между ними.</p>
                        
                        <p>— Мы не можем снова разойтись. Не сейчас.</p>
                        
                        <p>Саймон опустил голову.</p>
                        
                        <p>— Я помогу уничтожить их. Но мне нужен доступ к Сердцу Песни.</p>
                        
                        <p>Каэль взглянул на Лиру. Она кивнула.</p>
                        
                        <p>— Мы идём.</p>
                        
                        <p>Они отправились в Мир Тени — скрытый восьмой мир, забытый всеми. Здесь хранилось Сердце Песни — ядро, откуда она родилась.</p>
                        
                        <p>Путь был опасным. Существа без лиц нападали из темноты. Лира сражалась, её тело двигалось, как танец. Каэль защищал её, его магия вспыхивала, как гнев.</p>
                        
                        <p>В одной из пещер они нашли убежище. Огонь горел тихо. Лира сидела рядом с Каэлем, её пальцы скользили по его руке.</p>
                        
                        <p>— Ты всё ещё боишься меня?</p>
                        
                        <p>— Я боюсь потерять тебя.</p>
                        
                        <p>Она наклонилась, её губы коснулись его шеи.</p>
                        
                        <p>— Тогда не отпускай.</p>
                        
                        <p>И он не отпустил.</p>
                        
                        <p>Их тела слились в темноте, как миры, которые не должны были быть вместе. Песнь звучала вокруг — не как угроза, а как благословение.</p>
                    </div>
                `
            },
            { 
                id: 8, 
                title: 'Созданные тенью',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 8. Созданные тенью</h2>
                        <p>После уничтожения сущности, похожей на Лиру, тишина в Сердце Песни стала почти болезненной. Музыка стихла, но не исчезла — она затаилась, как зверь, наблюдающий из темноты.</p>
                        
                        <p>Каэль сидел на краю платформы, глядя в бесконечность. Лира подошла, её шаги были осторожными, как будто она боялась потревожить пространство.</p>
                        
                        <p>— Ты не должен был делать это один, — сказала она.</p>
                        
                        <p>— Я не мог позволить ей существовать. Она была… ложью.</p>
                        
                        <p>— Но красивой ложью.</p>
                        
                        <p>Он повернулся к ней. В её глазах — не гнев, не страх. Только усталость.</p>
                        
                        <p>— Ты боишься, что я выберу её вместо тебя?</p>
                        
                        <p>— Я боюсь, что ты выберешь идеал вместо реальности.</p>
                        
                        <p>Он взял её за руку.</p>
                        
                        <p>— Я выбираю тебя. С болью, с прошлым, с тенями. Потому что ты — настоящая.</p>
                        
                        <p>Она села рядом. Их плечи соприкоснулись. Музыка вокруг изменилась — стала мягче, теплее.</p>
                        
                        <p>— Песнь реагирует на нас, — прошептала Лира. — Она — зеркало.</p>
                        
                        <p>— Тогда мы должны быть честными.</p>
                        
                        <p>— Даже если это больно?</p>
                        
                        <p>— Особенно если это больно.</p>
                        
                        <p>В этот момент пространство дрогнуло. Появился новый портал — нестабильный, пульсирующий. Из него вышел человек. Высокий, в чёрной мантии, с глазами, как бездна.</p>
                        
                        <p>— Вы пробудили то, что должно было спать, — сказал он. — И теперь вы должны заплатить.</p>
                        
                        <p>Каэль встал. Его рука легла на рукоять меча.</p>
                        
                        <p>— Кто ты?</p>
                        
                        <p>— Я — первый носитель. Я — тот, кто создал Песнь.</p>
                        
                        <p>Саймон подошёл, его лицо было бледным.</p>
                        
                        <p>— Это невозможно. Ты исчез тысячу лет назад.</p>
                        
                        <p>— Я стал Песней. Я был её началом. И теперь я — её конец.</p>
                        
                        <p>Он поднял руку. Музыка взорвалась. Пространство дрогнуло. Лира закричала — не от боли, а от потери. Её память начал исчезать.</p>
                        
                        <p>— Он стирает нас! — крикнул Саймон.</p>
                        
                        <p>Каэль бросился вперёд, активируя Пепельный след. Он увидел путь — тонкую линию между звуком и тьмой. Он ударил — не по телу, а по ноте.</p>
                        
                        <p>Вспышка. Мужчина отступил.</p>
                        
                        <p>— Вы сильнее, чем я думал.</p>
                        
                        <p>— Потому что мы — вместе, — сказал Каэль.</p>
                        
                        <p>Лира восстановила память. Саймон активировал узел. Они объединились — магия, разум, тень.</p>
                        
                        <p>Мужчина исчез. Но не умер.</p>
                        
                        <p>— Я вернусь. И тогда Песнь будет моей.</p>
                        
                        <p>Портал закрылся.</p>
                        
                        <p>Они остались одни. Музыка стихла.</p>
                        
                        <p>Каэль обнял Лиру. Она дрожала.</p>
                        
                        <p>— Мы не проиграли, — сказал он.</p>
                        
                        <p>— Но и не победили.</p>
                        
                        <p>— Пока.</p>
                    </div>
                `
            },
            { 
                id: 9, 
                title: 'Мир Снов',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 9. Мир Снов</h2>
                        <p>После столкновения с Первым носителем, герои поняли: Песнь — не просто магия, а древняя воля, способная менять реальность. Чтобы остановить её и защитить миры, им нужно было найти фрагмент, способный уравновесить силу — Ноту Сна, спрятанную в разрушенном Мире Снов.</p>
                        
                        <p>Портал туда был нестабильным. Саймон долго настраивал узел, пока пространство не дрогнуло, и перед ними не открылся проход — не светящийся, а мерцающий, как воспоминание.</p>
                        
                        <p>— Мир Снов — опасен, — сказал он. — Здесь всё, что вы когда-либо чувствовали, может стать реальным.</p>
                        
                        <p>— Даже то, чего мы не хотим? — спросила Лира.</p>
                        
                        <p>— Особенно это.</p>
                        
                        <p>Они шагнули внутрь.</p>
                        
                        <p>Мир Снов был… странным. Небо — из зеркал, земля — из шелка, здания — из мыслей. Здесь не было логики. Только эмоции.</p>
                        
                        <p>Каэль почувствовал, как его способность дрожит. Следы были везде — страх, страсть, сожаление. Он увидел себя — не в отражении, а в реальности. Мальчик, стоящий над телом брата. Слёзы. Кровь. Молчание.</p>
                        
                        <p>— Это иллюзия, — прошептала Лира, беря его за руку. — Это не ты.</p>
                        
                        <p>— Это часть меня.</p>
                        
                        <p>Она обняла его. Её тепло было настоящим. Он закрыл глаза — и образ исчез.</p>
                        
                        <p>Они шли дальше. Существа из снов наблюдали — без глаз, без лиц, но с желаниями. Один из них приблизился к Лире. Он был похож на её бывшего — тот, кто предал её.</p>
                        
                        <p>— Ты скучала? — прошептал он.</p>
                        
                        <p>Лира замерла. Каэль шагнул вперёд, но она остановила его.</p>
                        
                        <p>— Я справлюсь.</p>
                        
                        <p>Она подошла к существу, коснулась его губ — и прошептала:</p>
                        
                        <p>— Я больше не боюсь тебя.</p>
                        
                        <p>Существо исчезло.</p>
                        
                        <p>Саймон нашёл вход в Хранилище Ноты — храм, построенный из песен. Внутри — тишина. В центре — кристалл, пульсирующий сном.</p>
                        
                        <p>— Это она, — сказал он. — Нота Сна. Баланс Песни.</p>
                        
                        <p>Каэль подошёл. Его рука дрожала.</p>
                        
                        <p>— Что будет, если я коснусь её?</p>
                        
                        <p>— Ты увидишь всё, что могло быть. Все жизни, где ты выбрал иначе.</p>
                        
                        <p>Он коснулся.</p>
                        
                        <p>Вспышка.</p>
                        
                        <p>Он увидел себя — с Лирой, в другом мире. Они — семья. Дети. Мир. Он увидел себя — один, в тени. Он увидел себя — мёртвым.</p>
                        
                        <p>Он отстранился. Лира держала его.</p>
                        
                        <p>— Ты выбрал меня. Здесь и сейчас.</p>
                        
                        <p>Он взял Ноту. Она слилась с его магией.</p>
                        
                        <p>— Теперь мы можем уравновесить Песнь.</p>
                        
                        <p>Но в этот момент пространство дрогнуло. Первый носитель вернулся.</p>
                        
                        <p>— Вы взяли то, что принадлежит мне.</p>
                        
                        <p>— Это принадлежит всем, — ответил Каэль.</p>
                        
                        <p>Сражение началось. Музыка взрывалась, сны рушились. Лира исчезала в тенях, Саймон связывал сознания. Каэль — пел. Его голос был новым. Сильным.</p>
                        
                        <p>Он использовал Ноту. Песнь дрогнула. Первый носитель закричал — не от боли, а от потери.</p>
                        
                        <p>— Вы не понимаете! Я — Песнь!</p>
                        
                        <p>— Нет, — сказал Каэль. — Ты — её тень.</p>
                        
                        <p>Он ударил. Свет. Тишина.</p>
                        
                        <p>Первый носитель исчез.</p>
                        
                        <p>Позже, в храме, Лира лежала рядом с Каэлем. Её пальцы скользили по его груди.</p>
                        
                        <p>— Ты пел.</p>
                        
                        <p>— Я чувствовал.</p>
                        
                        <p>— Это было красиво.</p>
                        
                        <p>Он поцеловал её. Медленно. Глубоко. Их тела слились — не как бегство, а как признание.</p>
                        
                        <p>Песнь звучала вокруг — не как угроза, а как обещание.</p>
                    </div>
                `
            },
            { 
                id: 10, 
                title: 'Возвращение домой',
                content: `
                    <div class="book-content__chapter">
                        <h2 class="book-content__chapter-title">Глава 10. Возвращение домой</h2>
                        <p>Пепельный мир встретил их тишиной. Но это была не та тишина, к которой они привыкли. Она была… наполненной. Как будто воздух сам слушал.</p>
                        
                        <p>Каэль шагнул на каменные плиты, чувствуя, как под ногами вибрирует магия. Песнь проникла сюда. Она изменила всё.</p>
                        
                        <p>— Город… живой, — прошептала Лира.</p>
                        
                        <p>— Или проснувшийся, — добавил Саймон.</p>
                        
                        <p>Они прошли по улицам, где раньше лежал пепел. Теперь — цветы. Серые, как дым, но тёплые на ощупь. Люди смотрели на них — не с подозрением, а с надеждой.</p>
                        
                        <p>— Они чувствуют, — сказал Каэль. — Что-то изменилось.</p>
                        
                        <p>— Мы изменили, — ответила Лира. — Но не всё к лучшему.</p>
                        
                        <p>В здании Совета их уже ждали. Старейшие из всех миров — хранители баланса. Их лица были скрыты, но голоса звучали, как аккорды.</p>
                        
                        <p>— Вы пробудили Песнь. Вы нарушили границы. Вы дали надежду. И страх.</p>
                        
                        <p>— Мы сделали то, что было необходимо, — сказал Каэль.</p>
                        
                        <p>— А теперь вы должны сделать выбор.</p>
                        
                        <p>— Какой?</p>
                        
                        <p>— Песнь хочет быть свободной. Она хочет петь во всех мирах. Но если она станет бесконтрольной — она разрушит всё.</p>
                        
                        <p>— И что мы можем сделать?</p>
                        
                        <p>— Стать её хранителями. Или её тюремщиками.</p>
                        
                        <p>Лира шагнула вперёд.</p>
                        
                        <p>— Мы не можем запереть то, что живое.</p>
                        
                        <p>— Но мы можем направить.</p>
                        
                        <p>Саймон молчал. Его взгляд был устремлён в окно, где пепел снова начал падать.</p>
                        
                        <p>— Я чувствую, — сказал он. — Песнь… меняется. Она учится.</p>
                        
                        <p>— Она — как ребёнок, — добавил Каэль. — Ей нужен голос. И сердце.</p>
                        
                        <p>Старейшие замолчали. Затем один из них сказал:</p>
                        
                        <p>— Тогда вы — её голос. И её сердце.</p>
                        
                        <p>Они покинули Совет. Вечером, в старом доме, где когда-то началось их путешествие, они сидели втроём. Огонь горел. Музыка звучала — тихо, как дыхание.</p>
                        
                        <p>Лира подошла к Каэлю. Её пальцы скользили по его щеке.</p>
                        
                        <p>— Ты изменился.</p>
                        
                        <p>— Ты тоже.</p>
                        
                        <p>— Мы — другие. Но всё ещё мы.</p>
                        
                        <p>Он поцеловал её. Медленно. Глубоко. Саймон отвернулся, улыбаясь.</p>
                        
                        <p>— Завтра — новый мир, — сказал он.</p>
                        
                        <p>— А сегодня — наша песня, — ответила Лира.</p>
                        
                        <p>За окном пепел перестал падать. Вместо него — первые ноты нового дня. И где-то вдалеке, между мирами, Песнь затихла — не умирая, а засыпая. Чтобы однажды проснуться снова.</p>
                        
                        <p>*** Конец первой части ***</p>
                    </div>
                `
            }
        ]
    };
    
    // DOM элементы
    const elements = {
        themeToggle: null,
        themeToggleBook: null,
        themeToggleDescription: null,
        backButton: null,
        backToMain: null,
        backToMainFromDescription: null,
        openBookButton: null,
        interactiveBook: null,
        mainPage: null,
        bookDescriptionPage: null,
        bookPage: null,
        prevPageBtn: null,
        nextPageBtn: null,
        comingSoonBook: null,
        comingSoonButton: null,
        readBookButton: null,
        pageInfo: null,
        bookContentBody: null,
        currentChapterTitle: null
    };
    
    // Инициализация приложения
    const init = () => {
        cacheElements();
        bindEvents();
        initTheme();
        initPageState();
        setupAccessibility();
        updateChapterNavigation();
        
        console.log('Приложение инициализировано. Тема:', state.theme);
    };
    
    // Кэширование DOM элементов
    const cacheElements = () => {
        elements.themeToggle = document.getElementById('theme-toggle');
        elements.themeToggleBook = document.getElementById('theme-toggle-book');
        elements.themeToggleDescription = document.getElementById('theme-toggle-description');
        elements.backButton = document.getElementById('back-button');
        elements.backToMain = document.getElementById('back-to-main');
        elements.backToMainFromDescription = document.getElementById('back-to-main-from-description');
        elements.openBookButton = document.getElementById('open-book-button');
        elements.interactiveBook = document.getElementById('interactive-book');
        elements.mainPage = document.getElementById('main-page');
        elements.bookDescriptionPage = document.getElementById('book-description-page');
        elements.bookPage = document.getElementById('book-page');
        elements.prevPageBtn = document.getElementById('prev-page');
        elements.nextPageBtn = document.getElementById('next-page');
        elements.comingSoonBook = document.getElementById('coming-soon-book');
        elements.comingSoonButton = document.getElementById('coming-soon-button');
        elements.readBookButton = document.getElementById('read-book-button');
        elements.pageInfo = document.getElementById('page-info');
        elements.bookContentBody = document.getElementById('book-content-body');
        elements.currentChapterTitle = document.getElementById('current-chapter-title');
    };
    
    // Настройка обработчиков событий
    const bindEvents = () => {
        // Переключение темы
        if (elements.themeToggle) {
            elements.themeToggle.addEventListener('click', toggleTheme);
        }
        
        if (elements.themeToggleBook) {
            elements.themeToggleBook.addEventListener('click', toggleTheme);
        }
        
        if (elements.themeToggleDescription) {
            elements.themeToggleDescription.addEventListener('click', toggleTheme);
        }
        
        // Навигация
        if (elements.openBookButton) {
            elements.openBookButton.addEventListener('click', openBookDescription);
        }
        
        if (elements.interactiveBook) {
            elements.interactiveBook.addEventListener('click', openBookDescription);
        }
        
        if (elements.backButton) {
            elements.backButton.addEventListener('click', goBackFromBook);
        }
        
        if (elements.backToMain) {
            elements.backToMain.addEventListener('click', goBackFromBook);
        }
        
        if (elements.backToMainFromDescription) {
            elements.backToMainFromDescription.addEventListener('click', goBackFromDescription);
        }
        
        // Кнопка "Читать книгу" на странице описания
        if (elements.readBookButton) {
            elements.readBookButton.addEventListener('click', openBookContent);
        }
        
        // Вторая книга (скоро будет доступно)
        if (elements.comingSoonBook) {
            elements.comingSoonBook.addEventListener('click', showComingSoonMessage);
        }
        
        if (elements.comingSoonButton) {
            elements.comingSoonButton.addEventListener('click', showComingSoonMessage);
        }
        
        // Навигация по главам книги
        if (elements.prevPageBtn) {
            elements.prevPageBtn.addEventListener('click', goToPrevChapter);
        }
        
        if (elements.nextPageBtn) {
            elements.nextPageBtn.addEventListener('click', goToNextChapter);
        }
        
        // Обработка нажатия кнопки "Назад" в браузере
        window.addEventListener('popstate', handlePopState);
        
        // Обработка предпочтений пользователя по анимациям
        const motionMediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
        motionMediaQuery.addEventListener('change', (e) => {
            state.prefersReducedMotion = e.matches;
        });
    };
    
    // Инициализация темы
    const initTheme = () => {
        // Проверяем сохранённую тему в localStorage
        const savedTheme = localStorage.getItem('theme');
        
        // Проверяем предпочтения системы
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        // Определяем тему: сначала сохранённая, затем системная
        if (savedTheme) {
            state.theme = savedTheme;
        } else if (systemPrefersDark) {
            state.theme = 'dark';
        } else {
            state.theme = 'light';
        }
        
        // Применяем тему
        applyTheme();
    };
    
    // Применение текущей темы
    const applyTheme = () => {
        if (state.theme === 'dark') {
            document.documentElement.classList.add('dark-theme');
        } else {
            document.documentElement.classList.remove('dark-theme');
        }
        
        // Сохраняем в localStorage
        localStorage.setItem('theme', state.theme);
    };
    
    // Переключение темы
    const toggleTheme = () => {
        state.theme = state.theme === 'dark' ? 'light' : 'dark';
        applyTheme();
        
        // Анимация переключения
        if (!state.prefersReducedMotion) {
            document.documentElement.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            setTimeout(() => {
                document.documentElement.style.transition = '';
            }, 300);
        }
    };
    
    // Инициализация состояния страницы
    const initPageState = () => {
        // Проверяем URL для определения текущей страницы
        const urlParams = new URLSearchParams(window.location.search);
        const chapter = urlParams.get('chapter');
        
        // Проверяем hash для страниц
        const hash = window.location.hash;
        
        if (chapter) {
            // Открываем книгу на указанной главе
            const chapterNum = parseInt(chapter);
            if (!isNaN(chapterNum) && chapterNum >= 1 && chapterNum <= state.totalChapters) {
                state.currentChapter = chapterNum;
                openBookPage(false);
                updateHistory('book', false);
            }
        } else if (hash === '#book') {
            // Открываем книгу на первой главе
            openBookPage(false);
            updateHistory('book', false);
        } else if (hash === '#description') {
            // Открываем описание книги
            openBookDescriptionPage(false);
            updateHistory('description', false);
        }
        
        // Загружаем контент главы
        loadChapterContent(state.currentChapter);
    };
    
    // Открытие описания книги
    const openBookDescription = () => {
        if (state.descriptionOpened) return;
        
        openBookDescriptionPage(true);
        updateHistory('description', true);
    };
    
    // Открытие страницы описания книги
    const openBookDescriptionPage = (withAnimation = true) => {
        state.currentPage = 'description';
        state.descriptionOpened = true;
        
        // Переключаем видимость страниц
        if (elements.mainPage) {
            elements.mainPage.classList.remove('active');
        }
        
        if (elements.bookDescriptionPage) {
            if (withAnimation && !state.prefersReducedMotion) {
                // Анимация появления страницы описания
                setTimeout(() => {
                    elements.bookDescriptionPage.classList.add('active');
                }, 100);
            } else {
                elements.bookDescriptionPage.classList.add('active');
            }
        }
        
        // Показываем кнопку "Назад" в шапке
        if (elements.backButton) {
            elements.backButton.style.display = 'block';
        }
    };
    
    // Открытие контента книги (с анимацией)
    const openBookContent = () => {
        if (state.bookOpened) return;
        
        // Добавляем класс для анимации открытия книги
        if (elements.interactiveBook && !state.prefersReducedMotion) {
            elements.interactiveBook.classList.add('book--opened');
            
            // Ждём завершения анимации и переходим на страницу книги
            setTimeout(() => {
                openBookPage(true);
                updateHistory('book', true);
            }, 800);
        } else {
            // Без анимации
            openBookPage(true);
            updateHistory('book', true);
        }
    };
    
    // Открытие страницы книги
    const openBookPage = (withAnimation = true) => {
        state.currentPage = 'book';
        state.bookOpened = true;
        
        // Переключаем видимость страниц
        if (elements.bookDescriptionPage) {
            elements.bookDescriptionPage.classList.remove('active');
        }
        
        if (elements.bookPage) {
            if (withAnimation && !state.prefersReducedMotion) {
                // Анимация появления страницы книги
                setTimeout(() => {
                    elements.bookPage.classList.add('active');
                }, 100);
            } else {
                elements.bookPage.classList.add('active');
            }
        }
        
        // Загружаем контент текущей главы
        loadChapterContent(state.currentChapter);
        
        // Показываем кнопку "Назад" в шапке
        if (elements.backButton) {
            elements.backButton.style.display = 'block';
        }
    };
    
    // Возврат из книги на главную
    const goBackFromBook = () => {
        if (state.currentPage !== 'book') return;
        
        // Закрываем книгу с анимацией
        if (elements.interactiveBook && !state.prefersReducedMotion) {
            elements.interactiveBook.classList.remove('book--opened');
        }
        
        // Переходим на главную страницу
        closeBookPage();
        updateHistory('main', true);
    };
    
    // Возврат из описания на главную
    const goBackFromDescription = () => {
        if (state.currentPage !== 'description') return;
        
        closeDescriptionPage();
        updateHistory('main', true);
    };
    
    // Закрытие страницы книги
    const closeBookPage = () => {
        state.currentPage = 'main';
        state.bookOpened = false;
        
        // Переключаем видимость страниц
        if (elements.bookPage) {
            elements.bookPage.classList.remove('active');
        }
        
        if (elements.mainPage) {
            elements.mainPage.classList.add('active');
        }
        
        // Скрываем кнопку "Назад" в шапке
        if (elements.backButton) {
            elements.backButton.style.display = 'none';
        }
    };
    
    // Закрытие страницы описания
    const closeDescriptionPage = () => {
        state.currentPage = 'main';
        state.descriptionOpened = false;
        
        // Переключаем видимость страниц
        if (elements.bookDescriptionPage) {
            elements.bookDescriptionPage.classList.remove('active');
        }
        
        if (elements.mainPage) {
            elements.mainPage.classList.add('active');
        }
        
        // Скрываем кнопку "Назад" в шапке
        if (elements.backButton) {
            elements.backButton.style.display = 'none';
        }
    };
    
    // Навигация по главам книги
    const goToPrevChapter = () => {
        if (state.currentChapter > 1) {
            state.currentChapter--;
            loadChapterContent(state.currentChapter);
            updateChapterNavigation();
            scrollToTop();
            updateHistory('book', true);
        } else {
            showMessage('Это первая глава.');
        }
    };
    
    const goToNextChapter = () => {
        if (state.currentChapter < state.totalChapters) {
            state.currentChapter++;
            loadChapterContent(state.currentChapter);
            updateChapterNavigation();
            scrollToTop();
            updateHistory('book', true);
        } else {
            showMessage('Это последняя доступная глава. Продолжение следует...');
        }
    };
    
    // Загрузка контента главы
    const loadChapterContent = (chapterNumber) => {
        if (chapterNumber < 1 || chapterNumber > state.totalChapters) {
            chapterNumber = 1;
        }
        
        const chapter = state.chapters[chapterNumber - 1];
        
        if (chapter && elements.bookContentBody) {
            elements.bookContentBody.innerHTML = chapter.content;
        }
        
        if (elements.currentChapterTitle) {
            elements.currentChapterTitle.textContent = `Глава ${chapterNumber}: ${chapter.title}`;
        }
        
        updateChapterNavigation();
    };
    
    const updateChapterNavigation = () => {
        if (elements.prevPageBtn) {
            elements.prevPageBtn.disabled = state.currentChapter === 1;
        }
        if (elements.nextPageBtn) {
            elements.nextPageBtn.disabled = state.currentChapter === state.totalChapters;
        }
        if (elements.pageInfo) {
            elements.pageInfo.textContent = `Глава ${state.currentChapter} из ${state.totalChapters}`;
        }
    };
    
    const scrollToTop = () => {
        window.scrollTo({
            top: 0,
            behavior: state.prefersReducedMotion ? 'auto' : 'smooth'
        });
    };
    
    // Обработка навигации по истории браузера
    const handlePopState = (event) => {
        // Проверяем URL параметры для главы
        const urlParams = new URLSearchParams(window.location.search);
        const chapter = urlParams.get('chapter');
        
        // Проверяем hash для страниц
        const hash = window.location.hash;
        
        if (chapter) {
            // Переход на главу книги
            const chapterNum = parseInt(chapter);
            if (!isNaN(chapterNum) && chapterNum >= 1 && chapterNum <= state.totalChapters) {
                state.currentChapter = chapterNum;
                if (state.currentPage !== 'book') {
                    openBookPage(true);
                } else {
                    loadChapterContent(state.currentChapter);
                }
            }
        } else if (hash === '#book') {
            // Переход на страницу книги (первая глава)
            if (state.currentPage !== 'book') {
                state.currentChapter = 1;
                openBookPage(true);
            }
        } else if (hash === '#description') {
            // Переход на страницу описания
            if (state.currentPage !== 'description') {
                openBookDescriptionPage(true);
            }
        } else {
            // Переход на главную страницу
            if (state.currentPage === 'book') {
                // Закрываем книгу с анимацией
                if (elements.interactiveBook && !state.prefersReducedMotion) {
                    elements.interactiveBook.classList.remove('book--opened');
                }
                closeBookPage();
            } else if (state.currentPage === 'description') {
                closeDescriptionPage();
            }
        }
    };
    
    // Обновление истории браузера
    const updateHistory = (page, pushState = true) => {
        if (pushState) {
            if (page === 'book') {
                // Добавляем параметр главы в URL
                const url = new URL(window.location);
                url.searchParams.set('chapter', state.currentChapter);
                url.hash = '#book';
                history.pushState({ page: 'book', chapter: state.currentChapter }, '', url);
            } else if (page === 'description') {
                history.pushState({ page: 'description' }, '', '#description');
            } else {
                // Возвращаемся к основному URL
                const url = new URL(window.location);
                url.search = '';
                url.hash = '';
                history.pushState({ page: 'main' }, '', url);
            }
        }
    };
    
    // Показать сообщение "Скоро будет доступно"
    const showComingSoonMessage = () => {
        // Создаем всплывающее сообщение
        const message = document.createElement('div');
        message.className = 'coming-soon-message';
        message.innerHTML = `
            <div class="coming-soon-message__content">
                <h3>Скоро будет доступно!</h3>
                <p>Книга "Теневые Тропы" находится в разработке.</p>
                <p>Следите за обновлениями!</p>
                <button class="coming-soon-message__close">Закрыть</button>
            </div>
        `;
        
        document.body.appendChild(message);
        
        // Показываем сообщение с анимацией
        setTimeout(() => {
            message.classList.add('coming-soon-message--visible');
        }, 10);
        
        // Обработка закрытия
        const closeBtn = message.querySelector('.coming-soon-message__close');
        closeBtn.addEventListener('click', () => {
            message.classList.remove('coming-soon-message--visible');
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 300);
        });
        
        // Закрытие по клику вне сообщения
        message.addEventListener('click', (e) => {
            if (e.target === message) {
                message.classList.remove('coming-soon-message--visible');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }
        });
        
        // Закрытие по клавише Escape
        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                message.classList.remove('coming-soon-message--visible');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
                document.removeEventListener('keydown', handleEscape);
            }
        };
        
        document.addEventListener('keydown', handleEscape);
    };
    
    // Показать всплывающее сообщение
    const showMessage = (text) => {
        const message = document.createElement('div');
        message.className = 'coming-soon-message';
        message.innerHTML = `
            <div class="coming-soon-message__content">
                <p>${text}</p>
                <button class="coming-soon-message__close">Закрыть</button>
            </div>
        `;
        
        document.body.appendChild(message);
        
        // Показываем сообщение с анимацией
        setTimeout(() => {
            message.classList.add('coming-soon-message--visible');
        }, 10);
        
        // Обработка закрытия
        const closeBtn = message.querySelector('.coming-soon-message__close');
        closeBtn.addEventListener('click', () => {
            message.classList.remove('coming-soon-message--visible');
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 300);
        });
        
        // Автоматическое закрытие через 3 секунды
        setTimeout(() => {
            if (message.parentNode) {
                message.classList.remove('coming-soon-message--visible');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }
        }, 3000);
    };
    
    // Настройка доступности
    const setupAccessibility = () => {
        // Улучшаем фокус для интерактивных элементов
        const interactiveElements = document.querySelectorAll('button, [tabindex]');
        
        interactiveElements.forEach(el => {
            el.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    el.click();
                }
            });
        });
        
        // Добавляем aria-label для интерактивных элементов, у которых нет текста
        const iconButtons = document.querySelectorAll('.theme-toggle');
        iconButtons.forEach(btn => {
            if (!btn.getAttribute('aria-label')) {
                btn.setAttribute('aria-label', 'Переключить тему');
            }
        });
    };
    
    // Публичные методы
    return {
        init,
        getState: () => ({ ...state }),
        openBookDescription,
        openBookContent,
        goBackFromBook,
        goBackFromDescription,
        toggleTheme,
        showComingSoonMessage,
        goToPrevChapter,
        goToNextChapter
    };
})();

// Инициализация приложения после загрузки DOM
document.addEventListener('DOMContentLoaded', App.init);
